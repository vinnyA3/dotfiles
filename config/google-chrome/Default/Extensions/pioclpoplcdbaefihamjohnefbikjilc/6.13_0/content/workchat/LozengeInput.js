/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

function LozengeInput(a,b,c,d,e,f,g,h){"use strict";function i(a){if(!n(a.id)){var b=(a.name||a.id).trim();if(b){var c=document.createElement("div");c.classList.add("loz_lozenge"),c.textContent=b,c.dataset.id=a.id,v.appendChild(c),c.addEventListener("click",function(){for(var a=v.getElementsByClassName("selected");a.length;)a[0].classList.remove("selected");this.classList.add("selected"),this.offsetLeft<v.scrollLeft?v.scrollLeft=this.offsetLeft:this.offsetLeft+this.offsetWidth>v.offsetWidth+v.scrollLeft&&(v.scrollLeft=this.offsetLeft+this.offsetWidth-v.offsetWidth)}),u[a.id]=a,x.placeholder="",v.scrollLeft=v.scrollWidth-v.offsetWidth,d()}}}function j(a,b){i(a),x.value="",clearTimeout(t)}function k(){for(var a=v.getElementsByClassName("selected");a.length;)a[0].classList.remove("selected");v.scrollLeft=v.scrollWidth-v.offsetWidth}function l(){x.focus()}function m(){var a=[];for(var b in u)a.push(u[b]);return a}function n(a){return null!==u[a]&&void 0!==u[a]}function o(){for(;v.firstElementChild;)q(v.firstElementChild)}function p(a){a&&a.parentNode&&(q(a),e(),v.children.length?d():(x.placeholder=b,r()))}function q(a){a&&a.parentNode&&(delete u[a.dataset.id],a.parentNode.removeChild(a),v.scrollLeft=v.scrollWidth-v.offsetWidth)}function r(){t=setTimeout(function(){c(x.value)},300)}function s(a,b){if(delete u[a],n(b.id)){for(var c=0;c<v.children.length;c++)if(v.children[c].dataset.id==a){p(v.children[c]);break}}else{u[b.id]=b;for(var c=0;c<v.children.length;c++)if(v.children[c].dataset.id==a){v.children[c].dataset.id=b.id,v.children[c].textContent=b.name;break}}}var t,u={},v=document.createElement("div");v.classList.add("loz_existing");var w=document.createElement("div");w.classList.add("loz_inputContainer");var x=document.createElement("input");x.classList.add("loz_input"),x.tabIndex=1,x.autofocus=!0,b&&(x.placeholder=b),x.addEventListener("keydown",function(a){if(8===a.keyCode||37===a.keyCode){if(0===this.selectionStart&&this.selectionStart===this.selectionEnd&&v.children.length){this.blur();for(var b=v.getElementsByClassName("selected");b.length;)b.classList.remove("selected");v.lastElementChild.classList.add("selected")}}else 38===a.keyCode?(g(),a.preventDefault()):40===a.keyCode?(h(),a.preventDefault()):13!==a.keyCode&&9!==a.keyCode||!f(this.value)||j({id:this.value})}),x.addEventListener("input",function(){clearTimeout(t),x.value?r():v.children.length?d():r()}),x.addEventListener("focus",k),window.addEventListener("keydown",function(a){if(a.target!==x){var b=v.getElementsByClassName("selected");if(b.length)if(8===a.keyCode)p(b[0]),x.focus();else if(37===a.keyCode){var c=b[0].previousElementSibling;c&&(b[0].classList.remove("selected"),c.classList.add("selected"),v.scrollLeft>c.offsetLeft&&(v.scrollLeft=c.offsetLeft))}else if(39===a.keyCode){var d=b[0].nextElementSibling;b[0].classList.remove("selected"),d?(d.classList.add("selected"),d.offsetLeft+d.offsetWidth>v.offsetWidth+v.scrollLeft&&(v.scrollLeft=d.offsetLeft+d.offsetWidth-v.offsetWidth)):x.focus()}}}),window.addEventListener("click",function(a){v.contains(a.target)||k()}),a.appendChild(v),w.appendChild(x),a.appendChild(w),this.addLozengeAndClearInput=j,this.blurExistingLozenges=k,this.focus=l,this.getLozenges=m,this.hasLozenge=n,this.input=x,this.removeAllLozengesOnly=o,this.updateExistingLozenge=s,Object.preventExtensions(this)}Object.preventExtensions(LozengeInput);