/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

function msgHandlerConfig(a,b,c){/china/i.test(a.bootstrapInfo.name)&&document.body.classList.add("china"),c&&"function"==typeof c&&c()}function showRefreshPageError(a){a&&a.message?(alert(REFRESH_PAGE_ERROR),log.error("Error FLE tooltip: "+a.message)):!FIREFOX&&chrome&&chrome.runtime&&chrome.runtime.lastError&&(log.error("Error FLE tooltip: "+chrome.runtime.lastError),alert(REFRESH_PAGE_ERROR))}function closeFrame(){Browser.sendToExtension({name:"bounce",message:{name:"ttc_close",which:NAME}})}function setHeight(){setTimeout(function(){Browser.sendToExtension({name:"bounce",message:{name:"ttc_setHeight",which:NAME,height:document.getElementById("main").offsetHeight}})},500)}function ssoDone(){Browser.sendToExtension({name:"businessSSOComplete"}),closeFrame()}var NAME,authed=!1,REFRESH_PAGE_ERROR="The Clipper couldn't start on this page. Reload the page and try again. If that doesn't help, contact customer support.",EVERNOTE_OUTLOOK_ADDIN_URL="https://store.office.com/evernote-for-outlook-WA104379617.aspx",EVERNOTE_OUTLOOK_ADDIN_LEARN_MORE="https://help.evernote.com/hc/articles/209005997",EVERNOTE_OUTLOOK_ADDIN_INSTALLED=!1;window.addEventListener("DOMContentLoaded",function(){for(var a=/(?:^#|&)([^=]+)=([^&]+)/g,b=a.exec(window.location.hash);b;)"which"===b[1]?NAME=b[2]:"locale"===b[1]&&/china/i.test(b[2])?document.body.classList.add("china"):"authed"===b[1]?("true"===b[2]&&(authed=!0),authed||document.body.classList.add("unauthed")):"permanent"===b[1]?window.permanent="true"===b[2]:"addin_installed"===b[1]&&"true"===b[2]?EVERNOTE_OUTLOOK_ADDIN_INSTALLED=!0:window[b[1]]=b[2],b=a.exec(window.location.hash);GlobalUtils.localize(document.body),document.body.classList.add(NAME),window.permanent&&document.body.classList.add("permanent"),document.getElementById("close").addEventListener("click",function(){"ssoInProgress"===NAME?ssoDone():"gmailTooltip"===NAME?(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"gmail",label:"tooltip_x_closed"}),closeFrame()):"googleInboxTooltip"===NAME?(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"gmail",label:"tooltip_x_closed"}),closeFrame()):"outlookTooltip"===NAME?(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:EVERNOTE_OUTLOOK_ADDIN_INSTALLED?"ol365-activate":"ol365-install",label:"tooltip_x_closed"}),closeFrame()):"office365InboxTooltip"===NAME?(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:EVERNOTE_OUTLOOK_ADDIN_INSTALLED?"ol365-activate":"ol365-install",label:"tooltip_x_closed"}),closeFrame()):"pdfTooltip"===NAME?(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"pdf",label:"tooltip_x_closed"}),closeFrame()):"wsj"===NAME?(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"wsj",label:"tooltip_x_closed"}),closeFrame()):"customTooltip"===NAME&&(Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"custom",label:"tooltip_x_closed"}),closeFrame())}),"gmailTooltip"===NAME?(document.getElementById("gmailButton").addEventListener("click",function(){Browser.sendToExtension({name:"toggleClipper"},showRefreshPageError),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"gmail",label:"open_clipper"}),closeFrame()}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"gmail",label:"tooltip_shown"})):"googleInboxTooltip"===NAME?(document.getElementById("googleInboxButton").addEventListener("click",function(){Browser.sendToExtension({name:"toggleClipper"},showRefreshPageError),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"gmail",label:"open_clipper"}),closeFrame()}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"gmail",label:"tooltip_shown"})):"outlookTooltip"===NAME?(document.getElementById("outlookTooltipButton").innerText=EVERNOTE_OUTLOOK_ADDIN_INSTALLED?Browser.i18n.getMessage("learnMore"):Browser.i18n.getMessage("installNow"),document.getElementById("outlookTooltipButton").addEventListener("click",function(){Browser.sendToExtension({name:"main_openTab",url:EVERNOTE_OUTLOOK_ADDIN_INSTALLED?EVERNOTE_OUTLOOK_ADDIN_LEARN_MORE:EVERNOTE_OUTLOOK_ADDIN_URL}),closeFrame()}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:EVERNOTE_OUTLOOK_ADDIN_INSTALLED?"ol365-activate":"ol365-install",label:"tooltip_shown"})):"office365InboxTooltip"===NAME?(document.getElementById("office365InboxTooltipButton").innerText=EVERNOTE_OUTLOOK_ADDIN_INSTALLED?Browser.i18n.getMessage("learnMore"):Browser.i18n.getMessage("installNow"),document.getElementById("office365InboxTooltipButton").addEventListener("click",function(){Browser.sendToExtension({name:"main_openTab",url:EVERNOTE_OUTLOOK_ADDIN_INSTALLED?EVERNOTE_OUTLOOK_ADDIN_LEARN_MORE:EVERNOTE_OUTLOOK_ADDIN_URL}),closeFrame()}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:EVERNOTE_OUTLOOK_ADDIN_INSTALLED?"ol365-activate":"ol365-install",label:"tooltip_shown"})):"pdfTooltip"===NAME?(permanent&&(document.getElementById("pdfButton").textContent=Browser.i18n.getMessage("safariContextClipPDF")),document.getElementById("pdfButton").addEventListener("click",function(){Browser.sendToExtension({name:"toggleClipper"},showRefreshPageError),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"pdf",label:(permanent?"permanent_":"")+"open_clipper"}),closeFrame()}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"pdf",label:(permanent?"permanent_":"")+"tooltip_shown"})):"ssoInProgress"===NAME?(document.getElementById("ssoLink").addEventListener("click",function(){Browser.sendToExtension({name:"openBusinessSSOPage"})}),document.getElementById("ssoClose").addEventListener("click",ssoDone)):"customTooltip"===NAME&&(document.getElementById("customButton").addEventListener("click",function(){Browser.sendToExtension({name:"toggleClipper"},showRefreshPageError),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"custom",label:"open_clipper"}),closeFrame()}),Browser.sendToExtension({name:"trackEvent",category:"Tooltip",action:"custom",label:"tooltip_shown"}),Browser.sendToExtension({name:"main_getConfig",bootstrapInfo:{name:null},returnName:"tooltipConfig"}),document.querySelector("#customTooltip .details").textContent=Browser.i18n.getMessage("topSitesTooltipBodyPart1",[Browser.i18n.getMessage(window.customSiteName)]),setHeight())}),Browser.addMessageHandlers({tooltipConfig:msgHandlerConfig});