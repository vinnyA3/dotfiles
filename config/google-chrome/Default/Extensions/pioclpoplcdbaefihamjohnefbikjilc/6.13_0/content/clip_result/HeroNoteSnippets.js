/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

function HeroNoteSnippets(a,b,c,d,e){"use strict";function f(a){var b=navigator.language,c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],e=new Date;if(a.getMonth()===e.getMonth()&&a.getDate()===e.getDate()&&a.getFullYear()===e.getFullYear())return Browser.i18n.getMessage("Today");if(e.valueOf()-a.valueOf()<=6048e5&&e.getDay()!==a.getDay())return Browser.i18n.getMessage(c[a.getDay()]);var f="%day %monthName %year",g=a.getDate();return b.match(/en-us/i)&&(f="%monthName %day, %year",g+=1==g||21==g||31==g?"st":2==g||22==g?"nd":3==g||23==g?"rd":"th"),b.match(/^zh/i)?f="%year\u5e74%month\u6708%day\u65e5":b.match(/^ja/i)&&(f="%year\u5e74%monthName%day\u65e5"),f=f.replace(/%day/,g),f=f.replace(/%year/,a.getFullYear()),f=f.replace(/%monthName/,Browser.i18n.getMessage(d[a.getMonth()])),f=f.replace(/%month/,a.getMonth()+1)}function g(a,b,c){i[a.guid]&&(i[a.guid].addEventListener("load",function(){this.style.top=(this.height-144)/-2+"px",this.style.left=(this.width-190)/-2+"px",this.parentNode.parentNode.classList.add("hnsHero")}),i[a.guid].src=a.datauri,delete i[a.guid]),c&&"function"==typeof c&&c()}function h(d,g,h){for(var j=document.createElement("table"),k=null,l=null,m=0;m<d.length;m++){var n=document.createElement("div");n.classList.add("hnsNote"),h&&n.classList.add("hnsGrid");var o=g||0===m||1===m&&2===d.length;if(o){d[m].thumbsquare||(d[m].thumbsquare="/shard/"+d[m].shardId+"/thm/note/"+d[m].guid);var p=document.createElement("div");p.classList.add("hnsThumbContainer");var q=document.createElement("img");Browser.sendToExtension({name:"downloadThumbnail",guid:d[m].guid,inBusinessNotebook:d[m].inBusinessNotebook,size:190,type:"note",url:b+d[m].thumbsquare}),i[d[m].guid]=q,p.appendChild(q),n.appendChild(p)}var r=document.createElement("div");r.classList.add("hnsTitle"),r.innerText=d[m].title,r.title=d[m].title,n.appendChild(r);var s=document.createElement("div");s.classList.add("hnsDateUrl");var t=document.createElement("span");if(t.classList.add("hnsDate"),t.innerText=f(new Date(d[m].updated)),s.appendChild(t),d[m].attributes.sourceURL){var u=document.createElement("a");u.classList.add("hnsUrl"),u.href=d[m].attributes.sourceURL,u.target="_blank",u.innerText=d[m].attributes.sourceURL.replace(/^https?:\/\/(?:www\.)?(.*?)\/.*/,"$1"),s.appendChild(u)}n.appendChild(s);var v=document.createElement("div");if(v.classList.add("hnsSnippet"),v.innerText=d[m].snippet,n.appendChild(v),d[m].notebookName){var w=document.createElement("div");w.classList.add("hnsNotebookName"),w.innerText=d[m].notebookName,n.appendChild(w),n.classList.add("hnsHasNotebookName")}n.dataset.guid=d[m].guid,n.dataset.shardId=d[m].shardId,n.dataset.notebookType=d[m].inBusinessNotebook?"business":"personal",n.addEventListener("click",function(a){Browser.sendToExtension({name:"main_recordActivity"}),a.target.classList.contains("hnsUrl")||a.target.classList.contains("hnsNotebookName")||Browser.sendToExtension({name:"main_openTab",url:GlobalUtils.getNoteURI(b,this.dataset.shardId,this.dataset.guid,c)}),e(this.dataset.notebookType)}),n.addEventListener("mouseover",function(a){a.target.classList.contains("hnsUrl")||a.target.classList.contains("hnsNotebookName")||this.classList.add("hnsHover")}),n.addEventListener("mouseout",function(a){this.classList.remove("hnsHover")}),o||1===m?(l=document.createElement("td"),l.appendChild(n),(!k||k.children.length>=2)&&(k=document.createElement("tr"),j.appendChild(k)),k.appendChild(l)):l.appendChild(n)}a.appendChild(j),0===d.length&&(a.dataset.noResult=Browser.i18n.getMessage("noResult"),a.classList.add("noResults"))}var i={};this.setNotes=h,Browser.addMessageHandlers({receiveThumbnail:g}),Object.preventExtensions(this)}Object.preventExtensions(HeroNoteSnippets);