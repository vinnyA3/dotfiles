/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

function NoteSnippets(a,b,c,d,e,f,g,h){"use strict";function i(a,b){a&&(s=a),t=b,s&&0!=s.length&&j()}function j(){l(s)}function k(){}function l(b){var c=a;if(c){c.innerHTML="";var d;for(var e in b){g||e%3!=0||(d=document.createElement("div"),d.className="row",c.appendChild(d));var f=document.createElement("div");f.className="container",f.appendChild(p(b[e],e));var h=q(b[e]);h&&f.appendChild(h),g?c.appendChild(f):d.appendChild(f)}t&&t>b.length&&c.appendChild(m())}}function m(){var a,c=t-s.length;a=1==c?Browser.i18n.getMessage("popup_oneMoreNoteLink"):Browser.i18n.getMessage("popup_moreNotesLink",[c.toString()]);var d=document.createElement("div");return d.className="moreOnServer",d.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"});var a=b+"/Home.action#x="+f;Browser.sendToExtension({name:"main_openTab",url:a})}),d.innerHTML=a,d}function n(a){var b=navigator.language,c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],e=new Date;if(a.getMonth()===e.getMonth()&&a.getDate()===e.getDate()&&a.getFullYear()===e.getFullYear())return Browser.i18n.getMessage("Today");if(e.valueOf()-a.valueOf()<=6048e5&&e.getDay()!==a.getDay())return Browser.i18n.getMessage(c[a.getDay()]);var f="%day %monthName %year",g=a.getDate();return b.match(/en-us/i)&&(f="%monthName %day, %year",g+=1==g||21==g||31==g?"st":2==g||22==g?"nd":3==g||23==g?"rd":"th"),b.match(/^zh/i)?f="%year\u5e74%month\u6708%day\u65e5":b.match(/^ja/i)&&(f="%year\u5e74%monthName%day\u65e5"),f=f.replace(/%day/,g),f=f.replace(/%year/,a.getFullYear()),f=f.replace(/%monthName/,Browser.i18n.getMessage(d[a.getMonth()])),f=f.replace(/%month/,a.getMonth()+1)}function o(b,c,d){var e=a.querySelector("img[guid='"+b.guid+"']");e&&(e.src=b.datauri,e.removeAttribute("guid")),d&&"function"==typeof d&&d()}function p(a,d){var e,f=document.createElement("div"),g=document.createElement("a");if(g.className="noteLink","expert"==a.type?(f.className="expert",g.target="_parent",g.href="evernote://business/user/"+a.id,f.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"}),h&&h(!0,!0)})):(f.className="noteBlock",g.target="_blank",g.href=GlobalUtils.getNoteURI(b,a.shardId,a.guid,c),f.addEventListener("click",function(){Browser.sendToExtension({name:"main_recordActivity"}),h&&h(a.inBusinessNotebook)})),"expert"==a.type)e=document.createElement("img"),e.className="smallimage",e.setAttribute("guid",a.id),Browser.sendToExtension({name:"downloadThumbnail",guid:a.id,method:"GET",size:60,url:b+"/user/"+a.id+"/photo"});else if(a.thumbsquare){var i=110;devicePixelRatio>=1.5&&(i*=2),e=document.createElement("img"),a.snippet&&(i=60,devicePixelRatio>=1.5&&(i*=2),e.className="smallimage"),e.setAttribute("guid",a.guid),Browser.sendToExtension({name:"downloadThumbnail",guid:a.guid,inBusinessNotebook:a.inBusinessNotebook,size:i,url:b+a.thumbsquare,type:"note"})}var j=document.createElement("div");if(j.className="snippet",a.snippet){var k=document.createElement("p");k.textContent=a.snippet,k.className="snippettext",a.thumbsquare&&(k.className+=" mixed")}var l=document.createElement("h1");if(l.textContent=a.title,"expert"==a.type){j.appendChild(e);var m=document.createElement("div");if(m.className="divider",j.appendChild(m),j.appendChild(l),a.role){var o=document.createElement("div");o.textContent=a.role,o.className="role",j.appendChild(o)}var p=document.createElement("a");p.className="seeMoreLink",p.textContent=Browser.i18n.getMessage("seeMore"),j.appendChild(p)}else{var q=document.createElement("p"),r=new Date(a.updated);q.textContent=n(r),q.className="date",j.appendChild(l),j.appendChild(q),a.snippet&&j.appendChild(k),a.thumbsquare&&j.appendChild(e)}return f.appendChild(j),f.appendChild(g),f}function q(a){if(a.contact||a.notebookName){u=!0;var b=document.createElement("div");return a.contact?b.className="contactName":b.className="notebookName",b.innerText=a.contact||a.notebookName,b.title=b.innerText,b}return null}function r(){return u}var s,t=0,u=!1;i(),this.setNotes=i,this.show=k,this.renderBlocks=l,this.hasAtLeastOneNotebookName=r,Browser.addMessageHandlers({receiveThumbnail:o}),Object.preventExtensions(this)}Object.preventExtensions(NoteSnippets);