/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

function ReminderSetter(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){var b=document.querySelector("#date span.focused");if(b){clearTimeout(w);var c=parseInt(s.innerText||s.textContent),d=parseInt(q.innerText||q.textContent)-1,e=parseInt(r.innerText||r.textContent);if(38==a.keyCode)b===s?A.selectDate(new Date(c+1,d,e),"year"):b===q?A.selectDate(new Date(c,d+1,e),"month"):b===r?A.selectDate(new Date(c,d,e+1),"date"):b===t?(hour=(hour+1)%24,A.selectDate(new Date(c,d,e),"hour")):b===u?(minute=(minute+1)%60,A.selectDate(new Date(c,d,e),"minute")):b===v&&(hour=(hour+12)%24,A.selectDate(new Date(c,d,e),"meridian"));else if(39==a.keyCode)b.nextElementSibling&&b.nextElementSibling.click();else if(40==a.keyCode)b===s?A.selectDate(new Date(c-1,d,e),"year"):b===q?A.selectDate(new Date(c,d-1,e),"month"):b===r?A.selectDate(new Date(c,d,e-1),"date"):b===t?(hour=(hour-1+24)%24,A.selectDate(new Date(c,d,e),"hour")):b===u?(minute=(minute-1+60)%60,A.selectDate(new Date(c,d,e),"minute")):b===v&&(hour=(hour-12+24)%24,A.selectDate(new Date(c,d,e),"meridian"));else if(37==a.keyCode)b.previousElementSibling&&b.previousElementSibling.click();else if(a.keyCode>=48&&a.keyCode<=57||a.keyCode>=96&&a.keyCode<=105){var f=a.keyCode%48;if(a.keyCode>57&&(f=a.keyCode%96),b===s)s.innerText.length<3?(s.innerText+=f,w=setTimeout(function(){A.selectDate(new Date(parseInt(s.innerText||s.textContent),d,e))},500)):3==s.innerText.length?(s.innerText+=f,A.selectDate(new Date(parseInt(s.innerText||s.textContent),d,e))):(s.innerText=f,w=setTimeout(function(){A.selectDate(new Date(parseInt(s.innerText||s.textContent),d,e))},500));else if(b===q)q.innerText.length<2?-1==d?(q.innerText=f,A.selectDate(new Date(c,f-1,e))):f<3?(q.innerText+=f,A.selectDate(new Date(c,parseInt(q.innerText||q.textContent)-1,e))):w=setTimeout(function(){A.selectDate(new Date(c,d,e))},500):(q.innerText=f,f>1?A.selectDate(new Date(c,f-1,e)):w=setTimeout(function(){var a=parseInt(q.innerText||q.textContent)-1;a=a<0?d:a,A.selectDate(new Date(c,a,e))},500));else if(b===r)r.innerText.length<2?e<2?(r.innerText+=f,A.selectDate(new Date(c,d,parseInt(r.innerText||r.textContent)))):new Date(c,d,10*e+f).getDate()==10*e+f?(r.innerText+=f,A.selectDate(new Date(c,d,parseInt(r.innerText||r.textContent)))):w=setTimeout(function(){A.selectDate(new Date(c,d,e))},500):(r.innerText=f,f>3?A.selectDate(new Date(c,d,parseInt(r.innerText||r.textContent))):w=setTimeout(function(){A.selectDate(new Date(c,d,parseInt(r.innerText||r.textContent)))},500));else if(b===t)if(t.innerText.length<2){var g=parseInt(t.innerText);0==g?(hour=f,A.selectDate(new Date(c,d,e))):1==g&&(f<3?(hour=10+f,A.selectDate(new Date(c,d,e))):w=setTimeout(function(){hour=1,A.selectDate(new Date(c,d,e))},500))}else f<2?(t.innerText=f,w=setTimeout(function(){0!=f&&(hour=f),A.selectDate(new Date(c,d,e))},500)):(hour=f,A.selectDate(new Date(c,d,e)));else if(b===u)if(u.innerText.length<2){var g=parseInt(u.innerText);minute=10*g+f,A.selectDate(new Date(c,d,e))}else f<6?(u.innerText=f,w=setTimeout(function(){0!=f&&(minute=f),A.selectDate(new Date(c,d,e))},500)):(minute=f,A.selectDate(new Date(c,d,e)))}else 65!=a.keyCode&&80!=a.keyCode||b===v&&(("AM"==v.innerText&&80==a.keyCode||"PM"==v.innerText&&65==a.keyCode)&&(hour=(hour+12)%24),A.selectDate(new Date(c,d,e)))}}function l(){var a=o.querySelector("#date span.focused");a&&a.classList.remove("focused"),this.classList.add("focused")}function m(a,b){var c=new Date(a.year,a.month,a.date,hour,minute,0,0);if(y.innerHTML=A.format(c),q=document.getElementById("selectedMonth"),r=document.getElementById("selectedDate"),s=document.getElementById("selectedYear"),t=document.getElementById("selectedHour"),u=document.getElementById("selectedMinute"),v=document.getElementById("selectedMeridian"),q.addEventListener("click",l),r.addEventListener("click",l),s.addEventListener("click",l),t.addEventListener("click",l),u.addEventListener("click",l),v.addEventListener("click",l),b)switch(b){case"year":s.click();break;case"month":q.click();break;case"date":r.click();break;case"hour":t.click();break;case"minute":u.click();break;case"meridian":v.click()}return c}function n(){if(h(),a.classList.contains("added")?(A.selectedDate()||(o.classList.remove("hasDate"),document.onkeydown=null),A.showTodayOrSelected()):(document.onkeydown=function(a){8==a.keyCode&&a.preventDefault()},a.classList.add("added"),x=Date.now(),Browser.sendToExtension({name:"setReminder",shardId:c,token:b,noteGuid:e,noteStoreUrl:d,title:f,sourceURL:g,reminderOrder:x}),j(ReminderSetter.REMINDER_TYPES.NO_DATE)),o.classList.toggle("visible"))a.classList.add("changingDate");else{a.classList.remove("changingDate");var i=o.querySelector("#date span.focused");i&&i.classList.remove("focused")}}var o=document.createElement("div");o.id="remindersSetter",o.innerHTML='<div id="noDate"><div class="reminderHeader">'+Browser.i18n.getMessage("reminderAdded")+'</div><div id="addDate" class="reminderButton">'+Browser.i18n.getMessage("addDate")+'</div></div><div id="hasDate"><div class="reminderHeader">'+Browser.i18n.getMessage("notifyMe")+'</div><div id="tomorrow" class="reminderButton">'+Browser.i18n.getMessage("tomorrow")+'</div><div id="nextWeek" class="reminderButton">'+Browser.i18n.getMessage("nextWeek")+'</div><div id="date"></div><div id="datePicker"></div></div>',a.parentNode.insertBefore(o,a.nextElementSibling);var p=Math.min(255,456-a.offsetLeft-38);p+130<456-a.offsetLeft+5?(o.style.left=Math.max(5,a.offsetLeft-38)+"px",o.style.transformOrigin=a.offsetLeft+9+"px 0"):(o.style.right=p+"px",o.style.transformOrigin="calc(100% - "+(456-p-a.offsetLeft+9)+"px) 0");var q,r,s,t,u,v,w,x=null,y=document.getElementById("date"),z=!1,A=new DatePicker(document.getElementById("datePicker"),function(a,h){Browser.sendToExtension({name:"setReminder",token:b,shardId:c,noteStoreUrl:d,noteGuid:e,title:f,sourceURL:g,reminderOrder:x,reminderTime:m(a,h)-0}),z||(z=!0,j(ReminderSetter.REMINDER_TYPES.CUSTOM_DATE))}),B=new Date;m({year:B.getFullYear(),month:B.getMonth(),date:B.getDate()});var C=document.getElementById("addDate"),D=document.querySelector("#noDate .reminderHeader");if(C.scrollWidth>C.clientWidth||D.scrollWidth>D.clientWidth||o.scrollHeight>o.clientHeight){var E=document.createElement("style");if(C.scrollWidth>C.clientWidth||D.scrollWidth>D.clientWidth){var F=Math.max(C.scrollWidth-C.clientWidth,D.scrollWidth-D.clientWidth);E.innerText="#remindersSetter { width: "+(112+F)+"px; }"}else o.scrollHeight>o.clientHeight&&(E.innerText="#remindersSetter { height: "+(165+o.scrollHeight-o.clientHeight)+"px; }");document.head.appendChild(E)}a.addEventListener("click",n),C.addEventListener("click",function(){h(),o.classList.add("hasDate")}),document.getElementById("tomorrow").addEventListener("click",function(){z||(z=!0,j(ReminderSetter.REMINDER_TYPES.TOMORROW));var a=new Date;a.setDate(a.getDate()+1),A.selectDate(a)}),document.getElementById("nextWeek").addEventListener("click",function(){z||(z=!0,j(ReminderSetter.REMINDER_TYPES.NEXT_WEEK));var a=new Date;a.setDate(a.getDate()+7),A.selectDate(a)}),o.addEventListener("click",function(a){if(!y.contains(a.target)){var b=o.querySelector("#date span.focused");b&&b.classList.remove("focused")}}),o.addEventListener(Browser.whichTransitionEnd(),function(a){if("width"===a.propertyName&&!o.classList.contains("hasDate")&&o.scrollHeight>o.clientHeight){var b=document.createElement("style");b.innerText="#remindersSetter { height: "+(53+o.scrollHeight-o.clientHeight)+"px; }",document.head.appendChild(b)}else"height"!==a.propertyName&&"opacity"!==a.propertyName||i()}),window.addEventListener("keydown",k),window.addEventListener("click",function(b){!o.classList.contains("visible")||o.contains(b.target)||a.contains(b.target)||n.call(a)}),this.__defineGetter__("height",function(){return o.classList.contains("visible")?o.offsetHeight+5:0}),this.__defineGetter__("top",function(){return o.offsetTop}),Object.preventExtensions(this)}ReminderSetter.REMINDER_TYPES={NO_DATE:1,TOMORROW:2,NEXT_WEEK:3,CUSTOM_DATE:4},Object.preventExtensions(ReminderSetter);