/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

function logCallback(a){self.postMessage({name:"log",msg:a})}function transform(a){for(var b=JSON.stringify(a),c=new ArrayBuffer(2*b.length),d=new Uint16Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return c}importScripts("../common/WebWorkerHelper.js"),importScripts("../../third_party/IndexedDBShim.min.js"),importScripts("../common/IDB.js");var num=0;self.addEventListener("message",function(a){"notebooks"==a.data.type?(IDB.getGroup(a.data.userId,"notebooks",null,null,function(a){if(a){var b=transform(a);self.postMessage({name:"persNotebooks",notebooks:b},[b])}++num>=2&&self.close()},logCallback),IDB.getGroup(a.data.userId,"sharedNotebooks",null,null,function(a){if(a){var b=transform(a);self.postMessage({name:"sharedNotebooks",notebooks:b},[b])}++num>=2&&self.close()},logCallback)):"tags"==a.data.type&&(IDB.getGroup(a.data.userId,"tags",null,null,function(a){if(a){var b=transform(a);self.postMessage({name:"persTags",tags:b},[b])}++num>=2&&self.close()},logCallback),IDB.getGroup(a.data.userId,"bizTags",null,null,function(a){if(a){var b=transform(a);self.postMessage({name:"bizTags",tags:b},[b])}++num>=2&&self.close()},logCallback))});