# Change the key prefix to <C-a>
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Add True Color support
set-option -sa terminal-overrides ",alacritty:RGB"
set -ga terminal-overrides ",*col*:Tc"

# lines
set -as terminal-overrides ",*:U8=0"

set -g default-terminal "tmux-256color"

# set default shell (bash as of now)
set-option -g default-shell /bin/zsh
# show status bar by default
set-option -g status on
# Set default key bindings to vim
set-window-option -g mode-keys vi
# Reset numbers to avoid windows lookling like: (0,1,3,2...)
set-option -g renumber-windows on
# set escape time so vim is responsive inside tmux
set -g escape-time 0
# set base index: starting @ 1
setw -g base-index 1
setw -g pane-base-index 1

set -g set-titles on
set -g set-titles-string "#T"

# reload tmux config
bind r source-file ~/.tmux/tmux.conf \; display "Reloaded ~/.tmux/tmux.conf"

bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# toggle status bar
bind-key b set status

###################################################################
# Theme and Appearance Configuration
###################################################################

# Color Palette (See Appearance, below, for usage)
# -- Catppuccin (https://raw.githubusercontent.com/catppuccin/tmux/main/catppuccin.conf)
# thm_bg="#1e1e28"
# thm_fg="#dadae8"
# thm_cyan="#c2e7f0"
# thm_black="#15121c"
# thm_gray="#332e41"
# thm_magenta="#c6aae8"
# thm_pink="#e5b4e2"
# thm_red="#e38c8f"
# thm_green="#b1e3ad"
# thm_yellow="#ebddaa"
# thm_blue="#a4b9ef"
# thm_orange="#f9c096"
# thm_black4="#575268"

# - Catppuccin - Latte
thm_bg="#dce0e8" # - crust
thm_fg="#4c4f69" # - text
thm_cyan="#179299" # - teal
thm_black="#5C5F77" # - subtext
thm_gray="#bcc0cc" # - surface1
thm_magenta="#ea76cb" # - pink
thm_pink="#8839ef" # - muave
thm_red="#d20f39" # - red
thm_green="#40a02b" # - green
thm_yellow="#df8e1d" # yellow
thm_blue="#1e66f5" # - blue
thm_orange="#fe640b" # - peach
thm_black4="#9ca0b0" #- overlay 0

# Appearance - note, the lightening emoji might not work well on linux terms

# ----------------------------=== Theme ===--------------------------
# status
set -g status-position top
set -g status "on"
set -g status-bg "${thm_bg}"
set -g status-justify "left"
set -g status-left-length "100"
set -g status-right-length "100"
# messages
set -g message-style fg="${thm_cyan}",bg="${thm_gray}",align="centre"
set -g message-command-style fg="${thm_cyan}",bg="${thm_gray}",align="centre"
# panes
set -g pane-border-style fg="${thm_gray}"
set -g pane-active-border-style fg="${thm_blue}"
set-option -g pane-border-format '-'
setw -g pane-border-format '─'
# windows
setw -g window-status-activity-style fg="${thm_fg}",bg="${thm_bg}",none
setw -g window-status-separator ""
setw -g window-status-style fg="${thm_fg}",bg="${thm_bg}",none

# --------=== Statusline
set -g status-left ""
set -g status-right "#[fg=$thm_pink,bg=$thm_bg,nobold,nounderscore,noitalics]#[fg=$thm_bg,bg=$thm_pink,nobold,nounderscore,noitalics] #[fg=$thm_fg,bg=$thm_gray] #H #{?client_prefix,#[fg=$thm_red],#[fg=$thm_green]}#[bg=$thm_gray]#{?client_prefix,#[bg=$thm_red],#[bg=$thm_green]}#[fg=$thm_bg] #[fg=$thm_fg,bg=$thm_gray] #S #[fg=$thm_black,bg=$thm_yellow]#{?window_zoomed_flag,  ,}"

# current_dir
# setw -g window-status-format "#[fg=$thm_bg,bg=$thm_blue] [#I] #W "
# setw -g window-status-current-format "#[fg=$thm_bg,bg=$thm_orange] [#I] #W "
setw -g window-status-format "#[fg=$thm_bg,bg=$thm_blue] #I:#W #[bg=$thm_bg] "
setw -g window-status-current-format "#[fg=$thm_bg,bg=$thm_orange] #I:#W #[bg=$thm_bg] "
# parent_dir/current_dir
# setw -g window-status-format "#[fg=colour232,bg=colour111] #I #[fg=colour222,bg=colour235] #(echo '#{pane_current_path}' | rev | cut -d'/' -f-2 | rev) "
# setw -g window-status-current-format "#[fg=colour232,bg=colour208] #I #[fg=colour255,bg=colour237] #(echo '#{pane_current_path}' | rev | cut -d'/' -f-2 | rev) "

# --------=== Modes
setw -g clock-mode-colour "${thm_blue}"
setw -g mode-style "fg=${thm_pink} bg=${thm_black4} bold"
# ----------------------------=== End Theme ===--------------------------

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
tmux_version='3.2' # hardcoded to avoid extra computation
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l

# Initialize Plugins - requires manual updating
run-shell '~/.tmux/plugins/tmux-pain-control/pain_control.tmux'
run-shell '~/.tmux/plugins/tmux-yank/yank.tmux'
